/*
All of the code within the ZingChart software is developed and copyrighted by ZingChart, Inc., and may not be copied,
replicated, or used in any other software or application without prior permission from ZingChart. All usage must coincide with the
ZingChart End User License Agreement which can be requested by email at support@zingchart.com.

Build 2.9.1
*/
zingchart.setModule("bubble-pack"),function(){var e=function(e,r){var a=(e.y-r.y)/(e.x-r.x);return[a,e.y-a*e.x,Math.atan((r.y-e.y)/(r.x-e.x))]},r=function(e,r,a,i){return[e+a*Math.cos(2*i*Math.PI/360),r+a*Math.sin(2*i*Math.PI/360)]},a=function(e){return 360*e/(2*Math.PI)},i=function(e,r,a){for(var i,t=a.padding,n=0;n<r.length;n++)if(i=Math.sqrt((e.x-r[n].x)*(e.x-r[n].x)+(e.y-r[n].y)*(e.y-r[n].y)),Math.round(i-e.r-r[n].r)<0)return!1;return i=Math.sqrt((e.x-a.x)*(e.x-a.x)+(e.y-a.y)*(e.y-a.y)),!(a.r-i-e.r<t)},t=function(t,n,l){for(var s=t.r,o=l.padding,p=!1,u=[],h=0;h<n.length;h++)for(var g=0;g<n.length;g++){var c=Math.sqrt((n[h].x-n[g].x)*(n[h].x-n[g].x)+(n[h].y-n[g].y)*(n[h].y-n[g].y));if(h!==g&&Math.floor(Math.abs(c-n[h].r-n[g].r))<=o){var d,f,b,x,v,_=(s+n[g].r)*(s+n[g].r)-(s+n[h].r)*(s+n[h].r),y=n[h].r+n[g].r,m=(_+y*y)/(2*y),C=Math.sqrt((s+n[g].r)*(s+n[g].r)-m*m),z=e(n[h],n[g]);x=(b=r(n[g].x,n[g].y,m,a(z[2])))[0],v=b[1],(x<Math.min(n[h].x,n[g].x)||x>Math.max(n[h].x,n[g].x)||v<Math.min(n[h].y,n[g].y)||v>Math.max(n[h].y,n[g].y))&&(x=(b=r(n[g].x,n[g].y,m,a(z[2])+180))[0],v=b[1]),d={x:(f=r(x,v,C,a(z[2])+90))[0],y:f[1],r:s,padding:o,idx:t.idx,info:t},i(d,n,l)&&(u.push(d),p=!0),d={x:(f=r(x,v,C,a(z[2])+270))[0],y:f[1],r:s,padding:o,idx:t.idx,info:t},i(d,n,l)&&(u.push(d),p=!0)}}return u.sort(function(e,r){return Math.sqrt((e.x-l.x)*(e.x-l.x)+(e.y-l.y)*(e.y-l.y))-Math.sqrt((r.x-l.x)*(r.x-l.x)+(r.y-l.y)*(r.y-l.y))}),u.length&&n.push(u[0]),p};zingchart.plugins.bubblepack=zingchart.plugins.bubblepack||{},zingchart.plugins.bubblepack.info=zingchart.plugins.bubblepack.info||{},zingchart.plugins.bubblepack.cache=zingchart.plugins.bubblepack.cache||{};var n=function(e,r,a){var i;if(""!==r.uid&&zingchart.plugins.bubblepack.cache[r.uid])return zingchart.plugins.bubblepack.cache[r.uid];var n=r.r,l=r.x,s=r.y,o=r.padding,p=r.maxItems||999,u=r.minSize||1.5,h=zingchart.plugins.bubblepack.info.groups[a]||{};e.sort(function(e,r){return e.group&&r.group?e.group===r.group?parseFloat(r.value)-parseFloat(e.value):null!==ZC._n_(h[e.group])&&null!==ZC._n_(h[r.group])?h[e.group]-h[r.group]:e.group<r.group?1:e.group>r.group?-1:0:parseFloat(r.value)-parseFloat(e.value)});var g=Math.min(p,e.length),c=0;for(i=0;i<g;i++)e[i].r=e[i]._r_=Math.sqrt(parseFloat(e[i].value)/Math.PI)+o/2,e[i].idx=i,c+=e[i].r*e[i].r*Math.PI;var d=1;if(g>1)if(g<25)d=Math.max(1e-4,(n-3*o)/(e[0].r+e[1].r));else{var f=.8;f=g>=50&&g<75?.85:g>=75&&g<100?.9:g>=100&&g<150?.95:1,d=Math.max(1e-4,Math.sqrt(f*n*n*Math.PI/c))}else 0===o&&(r.padding=o=1),d=Math.max(1e-4,(n-2*o)/e[0].r);var b=d/150,x=1;g>25&&g<=50?(b=d/125,x=1):g>50&&g<=100?(b=d/100,x=1.125):g>100&&g<=200?(b=d/75,x=1.25):g>200&&(b=d/50,x=1.5);for(var v=[],_=!0;_;){for(_=!1,i=0;i<g;i++)e[i].r=e[i]._r_*d;if(v=[],g>1)if(2*e[0].r+2*e[1].r+3*o>2*n)(d-=b)>0&&(_=!0);else{var y=e[0].r+e[1].r+o/2;for(v.push({x:l-y+e[0].r,y:s,r:e[0].r,idx:0,info:e[0]}),v.push({x:l+y-e[1].r,y:s,r:e[1].r,idx:1,info:e[1]}),i=2;i<g;i++)if(e[i].r>=u&&!t(e[i],v,r)){var m=i/g,C=1;if(g>100&&(m>=0&&m<.1?C=1.2:m>=.1&&m<.2?C=1.15:m>=.2&&m<.3?C=1.1:m>=.3&&m<.4&&(C=1.05),b+=C*x*b*(1-m)),(d-=b)>0){_=!0;break}}}else v.push({x:l,y:s,r:e[0].r-o,idx:0,info:e[0]})}return""!==r.uid&&(zingchart.plugins.bubblepack.cache[r.uid]=v),v},l=function(e,r){var a=ZC.IG(e.x||"0",!1);a<=1&&(a=r.x+r.width*a);var i=ZC.IG(e.y||"0",!1);i<=1&&(i=r.y+r.height*i);var t=ZC.IG(e.width||"0",!1);t<=1&&(t=r.width*t);var n=ZC.IG(e.height||"0",!1);return n<=1&&(n=r.height*n),{x:a+t/2,y:i+n/2,r:Math.min(t,n)/2}};zingchart.bind(null,"dataparse",function(e,r){for(var a,i,t,n,l=0,s=r.graphset.length;l<s;l++)if(r.graphset[l].type&&"bubble-pack"===r.graphset[l].type){var o=r.graphset[l].type;r.graphset[l]["plugin-type"]=o;var p=r.graphset[l];zingchart.normalize(p),p.type="null";var u={};p.options&&(u=p.options[o]||p.options),ZC._todash_(u),p.series=p.series||[];var h=u["text-attr"]||"text",g=u["value-attr"]||"value";if(!(p.series instanceof Array)){var c=[],d={},f=function(e,r){var a=(e.text||e.name||e[h]).toLowerCase().replace(/[^a-z0-9_]+/gi,"");d[a]?a+=d[a]++:d[a]=1;var i={id:a,text:e.text||e.name||e[h]||a,value:e.value||e.size||e[g],parent:r||""};if(c.push(i),e.children)for(var t=0;t<e.children.length;t++)f(e.children[t],a)};f(p.series),p.series=c}for(a=0;a<p.series.length;a++)p.series[a].text=p.series[a].text||p.series[a].name||p.series[a][h],p.series[a].value=p.series[a].value||p.series[a].size||p.series[a][g];var b=u["group-filter"]||[];for(zingchart.plugins.bubblepack.info.groups=zingchart.plugins.bubblepack.info.groups||{},zingchart.plugins.bubblepack.info.size=zingchart.plugins.bubblepack.info.size||{},zingchart.plugins.bubblepack.info.size[e.id]=p.series.length,zingchart.plugins.bubblepack.info.groups[e.id]={},a=0;a<b.length;a++)zingchart.plugins.bubblepack.info.groups[e.id][b[a]]=a;var x=b.length;for(a=0;a<p.series.length;a++)if(p.series[a].group&&null===ZC._n_(zingchart.plugins.bubblepack.info.groups[e.id][p.series[a].group])&&(zingchart.plugins.bubblepack.info.groups[e.id][p.series[a].group]=x++),null!==ZC._n_(p.series[a].parent))for(i=0;i<p.series.length;i++)p.series[i].id===p.series[a].parent&&(p.series[a].pidx=i,p.series[i].children=p.series[i].children||[],p.series[i].children.push(a));for(var v=!0,_=[];v;)for(v=!1,a=0;a<p.series.length;a++)if(null!==ZC._n_(p.series[a].parent)&&(t=p.series[a].parent,-1===ZC.AV(_,t))){var y=0,m=!0;for(n=-1,i=0;i<p.series.length;i++)p.series[i].id===t&&(n=i,p.series[a].pidx=i),null!==ZC._n_(p.series[i].parent)&&p.series[i].parent===t&&(null!==ZC._n_(p.series[i].value)?y+=ZC._f_(p.series[i].value):m=!1);if(m&&-1!==n){p.series[n].value=y,_.push(t),v=!0;continue}}for(var C=!0;C;)for(C=!1,a=0;a<p.series.length;a++)null===ZC._n_(p.series[a].level)&&(null===ZC._n_(p.series[a].parent)||""===p.series[a].parent?p.series[a].level=0:(n=p.series[a].pidx,null!==ZC._n_(n)&&(null===ZC._n_(p.series[n].level)?C=!0:p.series[a].level=ZC._i_(p.series[n].level)+1)));p.plotarea=p.plotarea||{},ZC._inj_(p.plotarea,{margin:"40 10 10 10","mask-tolerance":[0,0]})}return r});var s=function(e){var r,a,i=zingchart.getLoader(e.loader.id),t=zingchart.getGraph(i,e.graphid),s=t.o;if("bubble-pack"===s["plugin-type"]){var o=zingchart.getGraphInfo(i,s,t.L).plotarea;s.shapes=s.shapes||[];var p={};if(s.options&&(p=s.options["bubble-pack"]||s.options),ZC._todash_(p),e.shape&&null!==ZC._n_(p.active)&&!ZC._b_(p.active))return;var u=p.palette||["#FFEC94","#FFAEAE","#B0E57C","#B4D8E7","#FCCB8E"],h=s.series||[],g=ZC._f_(ZC._c_(p.padding,1)),c=ZC._i_(ZC._c_(p["min-level"],0)),d=ZC._i_(ZC._c_(p["max-items"],999)),f=p.filter||[],b=p["group-filter"]||[],x=ZC._f_(ZC._c_(p["min-size"],1.5)),v=p.containers||{},_=p.format||{},y=[].concat(f),m=c,C=e["data-top"]||"";if(""===C){var z="",Z=0;for(r=0;r<h.length;r++)h[r].parent&&""!==h[r].parent||(z=h[r].id,Z++);1===Z&&(C=z)}null!==ZC._n_(e["data-level"])&&(c=e["data-level"],C===e["data-id"]&&c--),null!==ZC._n_(e["data-id"])&&(C===e["data-id"]?(f=[e["data-parent"]],C=e["data-parent"]):(f=[e["data-id"]],C=e["data-id"])),c<m&&(c=m,f=[].concat(y));var M,k,I,w=[],F=ZC._i_(o.x+o.width/2),E=ZC._i_(o.y+o.height/2),q=ZC._i_(Math.min(o.width/2,o.height/2)),A=0;for(r=0;r<h.length;r++)A=Math.max(A,h[r].level);ZC._n_(p["max-level"])&&(A=ZC._i_(p["max-level"]));for(var G=c;G<=A;G++){for(k={},r=0;r<h.length;r++)if(h[r].level===G){if(I=h[r].parent||"0",G===c){var P=h[r].id;I=v[P]?P:"0"}k[I]=k[I]||[],(!f.length||h[r].level!==c||f.length&&-1!==ZC.AV(f,h[r].id))&&(""===h[r].group||!b.length||b.length&&-1!==ZC.AV(b,h[r].group))&&k[I].push(h[r])}for(I in k){var L=C+"/"+I+"/"+c+"/"+A;if(k[I].length){if(G===c)v[I]?((M=l(v[I],o)).padding=g,M.minSize=x,M.uid=""):M={uid:L,x:F,y:E,r:q,level:G,maxItems:d,minSize:x,padding:g};else{M=null;for(var S=0;S<w.length;S++)w[S].info.id===I&&(M={uid:L,x:w[S].x,y:w[S].y,r:w[S].r,level:G,maxItems:d,minSize:x,padding:g})}M&&(w=w.concat(n(k[I],M,e.id)))}}}var j=[];for(r=0;r<w.length;r++){var B=w[r].r-g/2;if(B>=x){var R=w[r].info,V=zingchart.formatNumber(R.value,_),O=R.text||"",D=O,N=V,T=Math.min(29,Math.floor(2*B*1.45/Math.max(3,O.length)));T<9&&(O=O.substring(0,3)+"...",(T=Math.min(29,Math.floor(2*B*1.45/Math.max(3,O.length))))<9&&(O="",V=""));var X=Math.min(19,Math.floor(2*B*.75/Math.max(3,V.length)));X<9&&(V=""),B<10&&(O=V="");var H=u[w[r].info.level%u.length];w[r].info.group&&(H=null!==ZC._n_(a=zingchart.plugins.bubblepack.info.groups[e.id][w[r].info.group])?u[(w[r].info.level+a)%u.length]:"#"+ZC.XL.md5(w[r].info.group).substring(0,6));var J={type:"circle",id:"bp_"+w[r].info.id,"data-id":w[r].info.id,"data-level":w[r].info.level,"data-parent":w[r].info.parent,"data-top":C,cls:"bp_item","border-width":1,"border-color":"#999","background-color":H,alpha:1,"text-align":"center",cursor:"hand",size:B,x:w[r].x,y:w[r].y,"hover-state":{"border-width":1,"border-color":"#000","background-color":"none"},label:{text:""},tooltip:{text:"%fullname<br>%fullvalue"}};w[r].info.children&&0!==w[r].info.children.length&&w[r].info.level!==A||(J.label={text:'<span style="font-size:'+T+'px">%name</span><br><span style="font-size:'+X+'px">%value</span>'}),ZC._cp_(p.item,J),ZC._cp_(p["item-level-"+w[r].info.level],J),ZC._cp_(p["item-group-"+w[r].info.group],J),ZC._cp_(p["item-id-"+w[r].info.id],J);var K=null;J.label.text=J.label.text.replace(/%fullname/g,D).replace(/%name/g,O).replace(/%fullvalue/g,N).replace(/%value/g,V),J.tooltip.text=J.tooltip.text.replace(/%fullname/g,D).replace(/%name/g,O).replace(/%fullvalue/g,N).replace(/%value/g,V);for(var Q in w[r].info)0===Q.indexOf("data-")&&(K=new RegExp("%"+Q,"g"),J.label.text=J.label.text.replace(K,w[r].info[Q]),J.tooltip.text=J.tooltip.text.replace(K,w[r].info[Q]));K=new RegExp("%data-([a-zA-Z0-9]+)","g"),J.label.text=J.label.text.replace(K,""),J.tooltip.text=J.tooltip.text.replace(K,""),K=new RegExp("<br><span(.+?)></span>","g"),J.label.text=J.label.text.replace(K,""),j.push(J)}}zingchart.exec(e.id,"removeobject",{type:"shape",cls:"bp_item"}),zingchart.exec(e.id,"addobject",{type:"shape",data:j})}};zingchart.bind(null,"gload",function(e){s(e)}),zingchart.bind(null,"shape_click",function(e){for(var r in ZC.cache.data)-1!==r.indexOf("area-score-"+e.id)&&delete ZC.cache.data[r];zingchart.plugins.bubblepack.info.size[e.id]>500&&zingchart.exec(e.id,"disable",{}),window.setTimeout(function(){s(e),zingchart.exec(e.id,"enable",{})},1)})}();