/*
All of the code within the ZingChart software is developed and copyrighted by ZingChart, Inc., and may not be copied,
replicated, or used in any other software or application without prior permission from ZingChart. All usage must coincide with the
ZingChart End User License Agreement which can be requested by email at support@zingchart.com.

Build 2.9.1
*/
zingchart.setModule("selection-tool"),zingchart.plugins.selectionTool=zingchart.plugins.selectionTool||{},zingchart.plugins.selectionTool.freeFormType={},zingchart.plugins.selectionTool.angle2D=function(e,t,i,o){var n,l;for(l=Math.atan2(t,e),n=Math.atan2(o,i)-l;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;return n},zingchart.plugins.selectionTool.isInsidePolygon=function(e,t,i){for(var o=0,n=[],l=[],a=e.length,c=0;c<a;c++)n[0]=e[c][0]-t,n[1]=e[c][1]-i,l[0]=e[(c+1)%a][0]-t,l[1]=e[(c+1)%a][1]-i,o+=zingchart.plugins.selectionTool.angle2D(n[0],n[1],l[0],l[1]);return Math.abs(o)>=Math.PI},zingchart.plugins.selectionTool.intersectRect=function(e,t){return!(t.iX>e.iX+e.I||t.iX+t.I<e.iX||t.iY>e.iY+e.F||t.iY+t.F<e.iY)},function(){var e=-1,t=-1,i=[],o="",n=null,l=!1,a=!1,c=function(n){zingchart.exec(n.id,"removeobject",{type:"shape",id:n.id+"-selection-poly"}),zingchart.exec(n.id,"removeobject",{type:"label",id:n.id+"-selection-rectangle"}),i=[],e=-1,t=-1,o=""},r=function(e,t){if(l){var i=zingchart.getLoader(e.id),o=i.M6||i.o,n=o.graphset?o.graphset[0]:o,a={};n["selection-tool"]&&n["selection-tool"].cursor&&(a=n["selection-tool"].cursor,ZC._todash_(a));var c={id:e.id+"-selection-cursor",type:"plus",x:e.x,y:e.y,"line-width":1,"line-color":"#cc0000",size:5,alpha:e.ev.shiftKey||e.ev.metaKey||t?1:0,flat:!0};a.label&&(c.label={anchor:"bl",alpha:e.ev.shiftKey||e.ev.metaKey||t?1:0,text:"Click to add points"}),ZC._cp_(a,c),zingchart.exec(e.id,"addobject",{type:"shape",data:c})}},s=function(e,t){l&&zingchart.exec(e.id,"updateobject",{type:"shape",id:e.id+"-selection-cursor",data:{x:e.x,y:e.y,alpha:e.ev.shiftKey||e.ev.metaKey||t?1:0,label:{alpha:e.ev.shiftKey||e.ev.metaKey||t?1:0}}})},d=function(e){a=!1,zingchart.exec(e.id,"removeobject",{type:"shape",id:e.id+"-selection-cursor"})},h=function(n){if(""!==o){var l,a,r,s,d,h,g=zingchart.getLoader(n.id),p=[],u=[],f=[],y=null,b=zingchart.exec(n.id,"getplotlength",{graphid:n.graphid});if(o="",n.ev.shiftKey||n.ev.metaKey||16===n.ev.keyCode){for(i.length>=2&&i.push([n.x,n.y]),l=0;l<b;l++)for(r=zingchart.exec(n.id,"getobjectinfo",{object:"plot",plotindex:l}),f[l]=r.xdata["append-selection"],d=zingchart.exec(n.id,"getnodelength",{graphid:n.graphid,plotindex:l}),a=0;a<d;a++)s=zingchart.exec(n.id,"getobjectinfo",{object:"node",plotindex:l,nodeindex:a}),null===ZC._n_(s)||s.xdata["ignore-selection"]||(zingchart.plugins.selectionTool.isInsidePolygon(i,s.x,s.y)||zingchart.plugins.selectionTool.isInsidePolygon(i,s.x+s.width,s.y)||zingchart.plugins.selectionTool.isInsidePolygon(i,s.x+s.width,s.y+s.height)||zingchart.plugins.selectionTool.isInsidePolygon(i,s.x,s.y+s.height))&&(u.push(s),null===ZC._n_(p[l])&&(p[l]=[]),p[l].push(a));(y=g.FH()).poly=i,ZC.AP.BZ("zingchart.plugins.selection-tool.mouseup",g,y)}else if(-1!==e&&-1!==t){var x,z,v,m,C=Math.min(e,n.x),Z=Math.max(e,n.x),T=Math.min(t,n.y),M=Math.max(t,n.y);if(Z-C<4||M-T<4)return;for(l=0;l<b;l++)for(r=zingchart.exec(n.id,"getobjectinfo",{object:"plot",plotindex:l}),f[l]=r.xdata["append-selection"],h=!1,-1!==ZC.AV(["vbar","hbar","vbar3d","hbar3d"],r.type)&&(h=!0),d=zingchart.exec(n.id,"getnodelength",{graphid:n.graphid,plotindex:l}),a=0;a<d;a++)s=zingchart.exec(n.id,"getobjectinfo",{object:"node",plotindex:l,nodeindex:a}),null!==ZC._n_(s)&&!s.xdata["ignore-selection"]&&s.onviewport&&(i=[[C,T],[C,M],[Z,M],[Z,T],[C,T]],x=s.x,z=s.y,v=s.width,m=s.height,s.bounds&&(x=s.bounds[0],z=s.bounds[1],v=s.bounds[2]-s.bounds[0],m=s.bounds[3]-s.bounds[1]),(h&&zingchart.plugins.selectionTool.intersectRect({iX:C,iY:T,I:Z-C,F:M-T},{iX:x,iY:z,I:v,F:m})||!h&&zingchart.plugins.selectionTool.isInsidePolygon(i,s.x,s.y))&&(u.push(s),null===ZC._n_(p[l])&&(p[l]=[]),p[l].push(a)));(y=g.FH()).poly=i,ZC.AP.BZ("zingchart.plugins.selection-tool.mouseup",g,y)}if(window.setTimeout(function(){c(n)},500),p.length>0){ZC.mobile&&(ZC.move=!1);var _=zingchart.exec(n.id,"getselection",{graphid:n.graphid});for(l=0;l<_.length;l++)if(f[l]&&_[l])for(p[l]||(p[l]=[]),a=0;a<_[l].length;a++)-1===ZC.AV(p[l],_[l][a])&&p[l].push(_[l][a]);window.setTimeout(function(){n.selection=p,n.nodes=u;var e=ZC.AP.BZ("zingchart.plugins.selection-tool.selection",g,n,!0);(null===ZC._n_(e)||ZC._b_(e))&&zingchart.exec(n.id,"setselection",{graphid:n.graphid,selection:p})},1)}}};ZC.A4(document).bind("keyup",function(e){16===e.keyCode&&null!==n&&(d(n),i.length>0&&(h(n),n=null))}),ZC.A4(document).bind("keydown",function(e){if(16===e.keyCode&&0===i.length&&null!==n){var t=zingchart.getLoader(n.id),o=zingchart.getModules(t);if(-1===ZC.AV(o,"selection-tool"))return;var l=t.M6||t.o,c=l.graphset?l.graphset[0]:l;zingchart.plugins.selectionTool.freeFormType[n.id]="lasso",c["selection-tool"]&&c["selection-tool"]["free-form-type"]&&(zingchart.plugins.selectionTool.freeFormType[n.id]=c["selection-tool"]["free-form-type"]),a?s(n,!0):r(n,!0)}}),zingchart.bind(null,"dblclick",function(e){i.length>0&&null!==e&&(h(e),d(e),n=null)}),zingchart.bind(null,"mousedown",function(l){if(n=l,-1===l.targetid.indexOf(l.graphid+"-preview")&&-1===l.targetid.indexOf(l.graphid+"-scroll")){var a=zingchart.getLoader(l.id),c=a.M6||a.o,r=c.graphset?c.graphset[0]:c,s=zingchart.getModules(a);if(-1!==ZC.AV(s,"selection-tool")){ZC.mobile||l.ev.preventDefault();var d=ZC.AP.BZ("zingchart.plugins.selection-tool.beforeselection",a,l,!0);if(void 0===d||d){var h={};r["selection-tool"]&&r["selection-tool"].mask&&(h=r["selection-tool"].mask,ZC._todash_(h));var g;if("none"===l.target)if(l.ev.shiftKey||l.ev.metaKey)if(i.push([l.x,l.y]),g={id:l.id+"-selection-poly",type:"poly",points:i,"border-width":1,"border-color":"#000000","background-color":"#ff9900",alpha:.2,flat:!0},ZC._cp_(h,g),"lasso"===zingchart.plugins.selectionTool.freeFormType[l.id])zingchart.exec(l.id,"addobject",{type:"shape",data:g});else if(1===i.length)zingchart.exec(l.id,"addobject",{type:"shape",data:g}),zingchart.exec(l.id,"updateobject",{type:"shape",id:l.id+"-selection-cursor",data:{label:{visible:!1}}});else{var p=[].concat(i);p[p.length]=[p[0][0],p[0][1]],zingchart.exec(l.id,"updateobject",{type:"shape",id:l.id+"-selection-poly",data:{points:p}})}else-1===e&&-1===t&&(e=l.x,t=l.y,g={id:l.id+"-selection-rectangle",x:e,y:t,width:4,height:4,"border-width":1,"border-color":"#000000","background-color":"#ff9900",alpha:.2,flat:!0},ZC._cp_(h,g),zingchart.exec(l.id,"addobject",{type:"label",data:g}));o=l.id}}}}),zingchart.bind(null,"mousemove",function(d){var h=zingchart.getLoader(d.id),g=zingchart.getModules(h);if(-1!==ZC.AV(g,"selection-tool"))if(n=d,l=!0,a?s(d):(a=!0,r(d)),d.id===o)if(ZC.mobile||d.ev.preventDefault(),d.ev.shiftKey||d.ev.metaKey){var p;"lasso"===zingchart.plugins.selectionTool.freeFormType[d.id]?i.length>0&&(i.push([d.x,d.y]),(p=[].concat(i))[p.length]=[p[0][0],p[0][1]],zingchart.exec(d.id,"updateobject",{type:"shape",id:d.id+"-selection-poly",data:{points:p}})):i.length>0&&((p=[].concat(i)).push([d.x,d.y]),p[p.length]=[p[0][0],p[0][1]],zingchart.exec(d.id,"updateobject",{type:"shape",id:d.id+"-selection-poly",data:{points:p}}))}else-1!==e&&-1!==t&&zingchart.exec(d.id,"updateobject",{type:"label",id:d.id+"-selection-rectangle",data:{x:Math.min(d.x,e),y:Math.min(d.y,t),width:Math.max(4,Math.abs(d.x-e)),height:Math.max(4,Math.abs(d.y-t))}});else c(d)}),zingchart.bind(null,"mouseout",function(e){l=!1,c(e),d(e)}),zingchart.bind(null,"mouseup",function(e){e.ev.shiftKey||e.ev.metaKey?"lasso"===zingchart.plugins.selectionTool.freeFormType[e.id]&&h(e):h(e)})}();